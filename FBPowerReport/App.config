<?xml version="1.0" encoding="utf-8"?>
<configuration>
    <startup> 
        <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.8"/>
    </startup>

  <connectionStrings>
    <!--<add name="FB_Connection" connectionString="data source=863781-APP1\SQLEXPRESS;initial catalog=FB_TEST;user id=sa;password=M@ir0cks;" providerName="System.Data.SqlClient" />-->
    <add name="FB_Connection" connectionString="data source=863781-APP1\FBMARS;initial catalog=FB_PROD;;user id=sa;password=FBM@RS17mai;" providerName="System.Data.SqlClient"/>
  <add name="FBEntities" connectionString="metadata=res://*/FBEntity.csdl|res://*/FBEntity.ssdl|res://*/FBEntity.msl;provider=System.Data.SqlClient;provider connection string=&quot;data source=863781-APP1\FBMARS;initial catalog=FB_PROD;user id=sa;password=FBM@RS17mai;MultipleActiveResultSets=True;App=EntityFramework&quot;" providerName="System.Data.EntityClient"/></connectionStrings>

  <appSettings>
    <add key="DaysFilter" value="-100"/>
    <!--<add key="OutputFilePath" value="D:\Websites\New folder\"/>
    <add key="ERFOutputFilePath" value="D:\Websites\New folder\ERFData\"/>
	  <add key="TechOutputFilePath" value="D:\Websites\New folder\TechData\"/>-->

    <add key="OutputFilePath" value="D:\Websites\MAIAutoPrograms\FBDataSend\Outgoing\" />
    <add key="ERFOutputFilePath" value="D:\Websites\MAIAutoPrograms\FBDataSend\Outgoing\ERFData\" />
    <add key="TechOutputFilePath" value="D:\Websites\MAIAutoPrograms\FBDataSend\Outgoing\TechData\" />
    
    <add key="OutputFileName" value="FBPowerData"/>
    <!--<add key="PowerDataQuery" value="SELECT WorkOrder.WorkorderID, WorkOrder.WorkorderEntryDate, WorkOrder.CustomerID,
                                      workorderschedule.Techid, workorderschedule.Techname,
                                      WorkOrder.WorkorderCallstatus, WorkOrder.PurchaseOrder, 'N' AS BillingID, WorkOrder.WorkorderErfid,
                                      workorderschedule.ScheduleDate,
                                      WorkOrder.WorkorderCloseDate, WorkOrder.WorkorderEquipCount, Contact.State as CustomerState,
                                      TECH_HIERARCHY.State as TechState,
                                      WorkOrder.ThirdPartyPO, WorkOrder.Estimate, WorkOrder.FinalEstimate, 'No' AS JREvents, WorkOrder.OriginalWorkorderid,
                                      WorkOrder.WorkorderCalltypeid, '' AS TechCalled, '' AS DESCF,
                                      workorderschedule.FSMID,
                                      WorkOrder.AppointmentDate, WorkorderDetails.StartDateTime,WorkorderDetails.ArrivalDateTime, WorkorderDetails.CompletionDateTime,
                                      Erf.OriginalRequestedDate, Erf.DateERFReceived,
                                      workorderschedule.Techid AS DispatchTechID,workorderschedule.TechName AS DispatchTechName,
                                      '' AS ProjectNumber, Erf.OriginalRequestedDate AS OrgCustReqDate, Erf.EquipETADate, '' AS ERFComplete,
                                      WorkOrder.NoServiceRequired, '' AS NoServiceReason, 'DELTA' AS DELTA
                                      FROM((WorkOrder INNER JOIN Contact ON WorkOrder.CustomerID = Contact.ContactID)
                                      Left Join WorkorderDetails ON WorkOrder.WorkorderID = WorkorderDetails.Workorderid
                                      Left Join workorderschedule On WorkOrder.WorkorderID = workorderschedule.WorkorderID
                                      Left Join TECH_HIERARCHY On workorderschedule.Techid = TECH_HIERARCHY.DealerId)
                                      LEFT JOIN Erf ON WorkOrder.WorkorderID = Erf.WorkorderID"/>-->

    <add key="PowerDataQuery" value="SELECT WorkOrder.WorkorderID, workorderequipment.Assetid, WorkOrder.WorkorderEntryDate, WorkOrder.CustomerID,                                     workorderschedule.Techid, workorderschedule.Techname,                                     WorkOrder.WorkorderCallstatus, WorkOrder.PurchaseOrder, 'N' AS BillingID, WorkOrder.WorkorderErfid,                                     workorderschedule.ScheduleDate,                                     WorkOrder.WorkorderCloseDate, WorkOrder.WorkorderEquipCount, Contact.State as CustomerState,                                     TECH_HIERARCHY.State as TechState,                                     WorkOrder.ThirdPartyPO, WorkOrder.Estimate, WorkOrder.FinalEstimate, 'No' AS JREvents, WorkOrder.OriginalWorkorderid,                                     WorkOrder.WorkorderCalltypeid, '' AS TechCalled, '' AS DESCF,                                     workorderschedule.FSMID,                                     WorkOrder.AppointmentDate, WorkorderDetails.StartDateTime,WorkorderDetails.ArrivalDateTime, WorkorderDetails.CompletionDateTime,                                     Erf.OriginalRequestedDate, Erf.DateERFReceived,                                     workorderschedule.Techid AS DispatchTechID,workorderschedule.TechName AS DispatchTechName,                                     '' AS ProjectNumber, Erf.OriginalRequestedDate AS OrgCustReqDate, Erf.EquipETADate, '' AS ERFComplete,                                     WorkOrder.NoServiceRequired, '' AS NoServiceReason, 'DELTA' AS DELTA,                                      WorkOrder.WorkorderCalltypeDesc, Contact.ESMName as FieldServiceManager, Contact.FSMJDE,                                     TECH_HIERARCHY.CompanyName,                                     WorkorderDetails.SolutionId,                                     workorderequipment.Systemid, workorderequipment.Symptomid, workorderequipment.SerialNumber, WorkorderParts.ProdNo,                                     workorderequipment.Manufacturer, workorderequipment.Category, WorkorderDetails.InvoiceNo,                                     TECH_HIERARCHY.FamilyAff, Contact.SearchType, Contact.SearchDesc,AllFBStatus.FBStatus As ServicePriority, WorkorderSchedule.EventScheduleDate                                      FROM((WorkOrder INNER JOIN Contact ON WorkOrder.CustomerID = Contact.ContactID)                                     Left Join WorkorderDetails ON WorkOrder.WorkorderID = WorkorderDetails.Workorderid                                     Left Join workorderschedule On WorkOrder.WorkorderID = workorderschedule.WorkorderID                                     Left Join TECH_HIERARCHY On workorderschedule.Techid = TECH_HIERARCHY.DealerId)                                     Left Join WorkorderEquipment on workorder.workorderid = workorderequipment.workorderid                                     Left Join WorkorderParts on Workorder.Workorderid = WorkorderParts.workorderid                                     LEFT JOIN Erf ON WorkOrder.WorkorderID = Erf.WorkorderID                                     Left Join AllFBStatus on AllFBStatus.FBStatusID = WorkOrder.PriorityCode"/>

    <!--<add key="WorkorderDataQuery" value="SELECT dbo.WorkOrder.WorkorderID, dbo.WorkOrder.WorkorderCallstatus, dbo.WorkOrder.CustomerID, dbo.WorkOrder.WorkorderEntryDate, 
                                    dbo.WorkOrder.WorkorderCloseDate, dbo.WorkOrder.WorkorderErfid, dbo.WorkOrder.WorkorderCalltypeid, dbo.WorkOrder.WorkorderCalltypeDesc, 
                                    dbo.WorkOrder.WorkorderSpawnEvent, dbo.WorkOrder.WorkorderClosureConfirmationNo, dbo.WorkOrder.PurchaseOrder, dbo.WorkOrder.CallerName, 
                                    dbo.WorkOrder.OvertimeRequest, dbo.WorkOrder.WorkorderContactPhone, dbo.WorkOrder.WorkorderContactName, dbo.WorkOrder.NoServiceRequired, 
                                    dbo.WorkOrder.ParentWorkorderid, dbo.WorkOrder.ThirdPartyPO, dbo.WorkorderSchedule.Techid, dbo.WorkorderSchedule.ScheduleDate, 
                                    dbo.WorkorderSchedule.TechName, dbo.WorkorderSchedule.TechPhone, dbo.WorkorderSchedule.ServiceCenterName, dbo.WorkorderSchedule.ServiceCenterID, 
                                    dbo.WorkOrder.AppointmentDate, dbo.Contact.SearchType, dbo.TECH_HIERARCHY.FamilyAff, dbo.Contact.FSMJDE, dbo.Contact.FieldServiceManager, 
                                    dbo.WorkorderDetails.StartDateTime, dbo.WorkorderDetails.ArrivalDateTime, dbo.WorkorderDetails.CompletionDateTime, dbo.Erf.OriginalRequestedDate 
                                    FROM (((dbo.WorkOrder INNER JOIN dbo.WorkorderSchedule ON dbo.WorkOrder.WorkorderID = dbo.WorkorderSchedule.WorkorderID) 
                                    INNER JOIN dbo.Contact ON dbo.WorkOrder.CustomerID = dbo.Contact.ContactID) 
                                    INNER JOIN dbo.WorkorderDetails ON dbo.WorkOrder.WorkorderID = dbo.WorkorderDetails.WorkorderID) 
                                    INNER JOIN dbo.TECH_HIERARCHY ON workorderschedule.Techid = TECH_HIERARCHY.DealerId
                                    LEFT JOIN dbo.Erf ON dbo.WorkOrder.WorkorderErfid = dbo.Erf.ErfID"/>-->
    

    <add key="WorkorderDataQuery" value="SELECT dbo.WorkOrder.WorkorderID, dbo.WorkOrder.WorkorderCallstatus, dbo.WorkOrder.CustomerID, dbo.WorkOrder.WorkorderEntryDate,  
         dbo.WorkOrder.WorkorderCloseDate, dbo.WorkOrder.WorkorderErfid, dbo.WorkOrder.WorkorderCalltypeid, dbo.WorkOrder.WorkorderCalltypeDesc,        
         dbo.WorkOrder.WorkorderSpawnEvent, dbo.WorkOrder.WorkorderClosureConfirmationNo, dbo.WorkOrder.PurchaseOrder, dbo.WorkOrder.CallerName,  
         dbo.WorkOrder.OvertimeRequest, dbo.WorkOrder.WorkorderContactPhone, dbo.WorkOrder.WorkorderContactName, dbo.WorkOrder.NoServiceRequired,      
         dbo.WorkOrder.ParentWorkorderid, dbo.WorkOrder.ThirdPartyPO, dbo.WorkorderSchedule.Techid, IIF(dbo.WorkorderSchedule.EventScheduleDate IS NOT NULL, dbo.WorkorderSchedule.EventScheduleDate, dbo.WorkorderSchedule.ScheduleDate) as ScheduleDate,              
         dbo.WorkorderSchedule.TechName, dbo.WorkorderSchedule.TechPhone, dbo.WorkorderSchedule.ServiceCenterName, dbo.WorkorderSchedule.ServiceCenterID,   
         dbo.WorkOrder.AppointmentDate, dbo.Contact.SearchType, dbo.TECH_HIERARCHY.FamilyAff, dbo.Contact.FSMJDE, dbo.Contact.ESMName as FieldServiceManager,
         dbo.WorkorderDetails.StartDateTime, dbo.WorkorderDetails.ArrivalDateTime, dbo.WorkorderDetails.CompletionDateTime, dbo.Erf.OriginalRequestedDate,      
         RS.RepeatedEventId as RepeatCallEvent, dbo.Workorder.WorkorderEquipCount,dbo.Contact.PricingParentID as PPID, dbo.Contact.PricingParentDesc as PPIDDesc, ABP.FBStatus as ServicePriority,   
         dbo.Contact.FilterReplaced, dbo.Contact.FilterReplacedDate, dbo.Contact.NextFilterReplacementDate, dbo.WorkorderDetails.WaterTested,        
         dbo.WorkorderDetails.HardnessRating, ABR.FBStatus as RescheduleReason, RR.RepeatedEventId as RepeatRepair                   
         FROM (((dbo.WorkOrder INNER JOIN dbo.WorkorderSchedule WITH (NOLOCK) ON dbo.WorkOrder.WorkorderID = dbo.WorkorderSchedule.WorkorderID) 
         INNER JOIN dbo.Contact WITH (NOLOCK) ON dbo.WorkOrder.CustomerID = dbo.Contact.ContactID)                                   
         LEFT JOIN dbo.WorkorderDetails WITH (NOLOCK) ON dbo.WorkOrder.WorkorderID = dbo.WorkorderDetails.WorkorderID)                  
         LEFT JOIN dbo.TECH_HIERARCHY WITH (NOLOCK) ON workorderschedule.Techid = TECH_HIERARCHY.DealerId                
         LEFT JOIN dbo.V_RepeatedPMandServiceEventDetails RS WITH (NOLOCK) ON RS.WorkorderID = dbo.WorkOrder.WorkorderID    
         LEFT JOIN dbo.V_RepeatServiceRepairDetails RR WITH (NOLOCK) ON RR.WorkorderID = dbo.WorkOrder.WorkorderID          
         LEFT JOIN dbo.Erf WITH (NOLOCK) ON dbo.WorkOrder.WorkorderErfid = dbo.Erf.ErfID                       
         LEFT JOIN dbo.AllFBStatus ABR WITH (NOLOCK) ON ABR.FBStatusID = dbo.WorkOrder.RescheduleReasonCode              
         RIGHT JOIN dbo.AllFBStatus ABP WITH (NOLOCK) ON ABP.FBStatusID = dbo.WorkOrder.PriorityCode"/>

    <add key="WorkorderEquipmentDataQuery" value="SELECT dbo.WorkorderEquipment.WorkorderID, dbo.WorkorderEquipment.Assetid, dbo.WorkorderEquipment.CallTypeid, 
         dbo.WorkorderEquipment.Category, dbo.WorkorderEquipment.Manufacturer, dbo.WorkorderEquipment.Model, dbo.WorkorderEquipment.Location,          
         dbo.WorkorderEquipment.SerialNumber, dbo.WorkorderEquipment.Solutionid, dbo.WorkorderEquipment.Temperature,                                
         dbo.WorkorderEquipment.Systemid, dbo.WorkorderEquipment.Symptomid                               
         FROM (((dbo.WorkOrder INNER JOIN dbo.WorkorderSchedule ON dbo.WorkOrder.WorkorderID = dbo.WorkorderSchedule.WorkorderID)    
         LEFT JOIN dbo.WorkorderEquipment ON dbo.WorkOrder.WorkorderID = dbo.WorkorderEquipment.WorkorderID                              
         INNER JOIN dbo.Contact ON dbo.WorkOrder.CustomerID = dbo.Contact.ContactID)                                   
         LEFT JOIN dbo.WorkorderDetails ON dbo.WorkOrder.WorkorderID = dbo.WorkorderDetails.WorkorderID)                  
         LEFT JOIN dbo.Erf ON dbo.WorkOrder.WorkorderErfid = dbo.Erf.ErfID"/>
    <add key="WorkorderPartsDataQuery" value="SELECT dbo.WorkorderParts.WorkorderID, dbo.WorkorderParts.Sku, dbo.WorkorderParts.Description,  
         dbo.WorkorderParts.Quantity, dbo.WorkorderParts.AssetID                                 
         FROM (((dbo.WorkOrder INNER JOIN dbo.WorkorderSchedule ON dbo.WorkOrder.WorkorderID = dbo.WorkorderSchedule.WorkorderID)  
         INNER JOIN dbo.Contact ON dbo.WorkOrder.CustomerID = dbo.Contact.ContactID)                               
         LEFT JOIN dbo.WorkorderDetails ON dbo.WorkOrder.WorkorderID = dbo.WorkorderDetails.WorkorderID)              
         INNER JOIN dbo.WorkorderParts ON dbo.WorkOrder.WorkorderID = dbo.WorkorderParts.WorkorderID                   
         LEFT JOIN dbo.Erf ON dbo.WorkOrder.WorkorderErfid = dbo.Erf.ErfID"/>

    <add key="ERFDataQuery" value="Select ERF.WorkorderID,ERF.ERFID,EntryUser.FirstName+' '+EntryUser.LastName as ERFEntryUser,'' as  OriginatorName, Contact.CompanyName, Workorder.WorkorderCloseDate, Workorder.WorkorderCallstatus,   
         ERF.ERFStatus,ERF.CustomerID,ERF.OriginalRequestedDate,ERF.EntryDate as ERFEntryDate, ModifiedUser.FirstName +' '+ModifiedUser.LastName as ERFLastUpdatedUser, ERF.ModifiedDate as ERFLastUpdatedDate, 
         ERF.OrderType, ERF.ShipToBranch, ERF.SiteReady,ERF.CurrentNSV, (ERF.TotalNSV + ERF.CurrentNSV) as TotalNSV,ERF.ApprovalStatus,                         
         Contact.CompanyName, Contact.Address1, Contact.City,                               
         Contact.State,Contact.PostalCode, Contact.FieldServiceManager, Contact.FSMJDE, Contact.PricingParentName,  
         Contact.DeliveryDesc,                             
         Contact.CustomerRegion,Contact.RegionNumber, Contact.CustomerBranch,Contact.Branch,Contact.SearchType,        
         Contact.SearchDesc,Contact.PricingParentID, ERF.OriginalRequestedDate as AppointmentDate,       
         fbeqp.Quantity as EqpQty, '' as EquipmentTotal, fbexp.Quantity as ExpQty, '' as ExpandableTotal,'' as Total,     
         C.ContingentType as EqpType, C.ContingentName as EqpName, CD.Name as EqpCategoryName,                       
         C1.ContingentType as ExpType, C1.ContingentName as ExpName,CD1.Name as ExpCategoryName,                     
         ERF.WorkorderID,ERF.ERFID,Contact.CompanyName, 
		 fbeqp.InternalOrderType as EqpInternalType, fbeqp.VendorOrderType as EqpVendorType,    
         fbexp.InternalOrderType as ExpInternalType, fbexp.VendorOrderType as ExpVendorType,                      
         Workorderschedule.EntryDate as DispatchDate, Workorderschedule.ModifiedScheduleDate as AcceptedDate, DispatchTech.CompanyName As DispatchTech, ERF.Tracking
         from ERF (nolock)                                     
         INNER JOIN Contact (nolock) ON ERF.CustomerID = Contact.ContactID                                
         LEFT JOIN FBERFEquipment as fbeqp (nolock) ON fbeqp.ERFId = Erf.ErfID                                    
         LEFT JOIN Contingent as C (nolock) ON C.ContingentID = fbeqp.ContingentCategoryId    
         LEFT JOIN ContingentDetails as CD (nolock) ON CD.ID = fbeqp.ContingentCategoryTypeId           
         LEFT JOIN FBERFExpendable as fbexp (nolock) ON fbexp.ERFId = Erf.ErfID                         
         LEFT JOIN Contingent as C1 (nolock) ON C1.ContingentID = fbexp.ContingentCategoryId             
         LEFT JOIN ContingentDetails as CD1 (nolock) ON CD1.ID = fbexp.ContingentCategoryTypeId             
         LEFT JOIN Workorder (nolock) ON ERF.WorkorderID = Workorder.WorkorderID                
         LEFT JOIN Workorderschedule (nolock) ON Workorderschedule.WorkorderID = Workorder.WorkorderID and (Workorderschedule.AssignedStatus = 'Accepted' or Workorderschedule.AssignedStatus = 'Sent')     
         LEFT JOIN TECH_HIERARCHY DispatchTech (nolock) ON DispatchTech.DealerId = WorkorderSchedule.Techid   
         LEFT JOIN FbUserMaster EntryUser (nolock) ON EntryUser.UserId = ERF.EntryUserID                      
         LEFT JOIN FbUserMaster ModifiedUser (nolock) ON ModifiedUser.UserId = ERF.ModifiedUserID "/>

	<add key="TechDataQuery" value="select DealerId, CompanyName, City, State, IIF(SearchType='SP', 1, 0) as IsActive, IIF(FamilyAff='SPD', 'Internal', 'ThirdParty') as  FamilyAff, 
        FieldServiceManager, BranchNumber, BranchName, RegionNumber, RegionName
        from TECH_HIERARCHY th
        where SearchType = 'SP' and FamilyAff = 'SPD'"/>
       </appSettings>
</configuration>
